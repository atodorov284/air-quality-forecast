# Air Quality Forecast

<a target="_blank" href="https://cookiecutter-data-science.drivendata.org/">
    <img src="https://img.shields.io/badge/CCDS-Project%20template-328F97?logo=cookiecutter" />
</a>

Air pollution is a significant environmental concern, especially in urban areas, where the high levels of nitrogen dioxide and ozone can have a negative impact on human health, the ecosystem and on the overall quality of life. Given these risks, monitoring and forecasting the level of air pollution is an important task in order to allow for timely actions to reduce the harmful effects. 

In the Netherlands, cities like Utrecht experience challenges concerning air quality due to urbanization, transportation, and industrial activities. Developing a system that can provide accurate and robust real-time air quality monitoring and reliable forecasts for future pollution levels would allow authorities and residents to take preventive measures and adjust their future activities based on expected air quality. This project focuses on the time-series forecasting of air pollution levels, specifically NO<sub>2</sub> and O<sub>3</sub> concentrations, for the next three days. This task can be framed as a regression problem, where the goal is to predict continuous values based on historical environmental data. Moreover, it provides infrastructure for real-time prediction, based on recent measurements.

## How To Run This Code

Currently, this repository finished the model development stage. 

To run the data pipeline, run `data_pipeline.py` under air-quality forecast, which is the folder that contains the source code of this project. The processed and split datasets can be found under data/processed, namely x_train, x_val, x_test, y_train, y_val, y_test.

To see the MLFlow dashboard, used to track experiments, run model_development.py. It will automatically create a server at your localhost port 5000. If this does not work, please run
`mlflow ui --port 5000`
in your console. You might need to give admin permissions to this process. The MLFlow dashboard contains all information about the experiments ran, including hyperparameters selected for each model. The selected models can be found under the Models menu.

To retrain a model or predict, run `main.py` with the following arguments:
positional arguments:
  {xgboost,decision_tree,random_forest}
                        Model to retrain or predict.

options:
  -h, --help            show this help message and exit
  --retrain             Re-train the model.
  --predict             Predict using the trained model.


**IMPORTANT**
The retrain datasets need to be under data/retrain and the prediction dataset needs to be under data/inference.

If --retrain is selected, specify the dataset name, which has to be under data/inference. For example, if the dataset is named x_test.csv and you want to predict using the xgboost model, run:
`main.py --predict --prediction_dataset x_test.csv xgboost`

Similarly, to retrain xgboost for example, run:
`main.py --retrain --x_train x_train.csv --x_test x_test.csv --y_train y_train.csv --y_test y_test.csv --n_iter 50 xgboost`

## DISCLAIMER

The notebooks in this project were used as scratch for analysis and data merge and do not reflect our thorough methodology (source is under air-quality-forecast). Some extra scripts for the generation of our plots in the report can be found under extra_scripts.

## Project Organization

```
├── LICENSE            <- Open-source license if one is chosen
├── Makefile           <- Makefile with convenience commands like `make data` or `make train`
├── README.md          <- The top-level README for developers using this project.
├── data
│   ├── processed      <- The final, canonical data sets for modeling. Contains the train-test split.
│   └── raw            <- The original, immutable data dump.
│
├──.github             <- Contains automated workflows for reproducibility and flake8 checks. 
│
├── docs               <- TODO: A default mkdocs project; see www.mkdocs.org for details
│
├───mlruns             <- Contains all the experiments ran using mlflow.
│
├───mlartifacts        <- Contains the artifacts generated by mlflow experiments.
│
├── notebooks          <- Jupyter notebooks (not to be evaluated, source code is in air-quality-forecast)
│
├── pyproject.toml     <- Project configuration file with package metadata for 
│                         air-quality-forecast and configuration for tools like black
│
├── references         <- TODO: Data dictionaries, manuals, and all other explanatory materials.
│
├── reports            <- TODO: Generated analysis as HTML, PDF, LaTeX, etc.
│   └── figures        <- TODO: Generated graphics and figures to be used in reporting
│
├── requirements.txt   <- The requirements file for reproducing the analysis environment, e.g.
│                         generated with `pip freeze > requirements.txt`
│
├── setup.cfg          <- Configuration file for flake8
│
├── configs            <- Configuration folder for the hyperparameter search space (for now)
│
├── saved_models       <- Folder with the saved models in `.pkl` and `.xgb`.
│
├── extra_scripts      <- Some extra scripts in R and .tex to generate figures
│
└── air-quality-forecast   <- Source code for use in this project.
    │
    ├── __init__.py             <- Makes air-quality-forecast a Python module
    │
    ├── data_pipeline.py        <- Loads, extracts, and preprocesses the data. Final result is the train-test under data/processed
    │
    ├── model_development.py    <- Trains the three models using k-fold CV and Bayesian hyperparameter tuning, displays the ML │                              dashboard if executed
    │
    ├── prediction.py           <- Loads the models and makes an example prediction
    │
    ├── utils.py                <- Utility functions, e.g. validation
    │
    └── main.py                 <- To execute and start the project. Currently to make predictions.

--------

# air-quality-forecast
